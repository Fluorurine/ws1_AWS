[{"uri":"/en/2-architecture/2.1-architectureflow/","title":"How the architecture work?","tags":[],"description":"","content":"\nHow the architecture work? The client requests the URL of CloudFront distribution to get a particular website file in the S3 bucket.\nCloudFront sends the request to AWS WAF. AWS WAF filters the request by using the web ACLs applied to the CloudFront distribution.\nIf the request is determined to be valid, the flow continues. If the request is determined to be invalid, the client receives a 403 error. CloudFront checks its internal cache. If there is a valid key matching the incoming request, the associated value is sent back to the client as a response. If not, the flow continues.\nCloudFront forwards the request to the URL of the specified Application Load Balancer.\nThe Application Load Balancer has a listener associated with a target group based on a Lambda function. The Application Load Balancer invokes the Lambda function.\nThe Lambda function connects to the S3 bucket, perform a GetObject operation on it, and returns the content as a response.\n"},{"uri":"/en/1-introduce/","title":"Introduction","tags":[],"description":"","content":"Introduction This architecture is inspired by This AWS Prescriptive Guidance ideal.\nWhen you serve static content that is hosted on Amazon Web Services (AWS), the recommended approach is to use an Amazon Simple Storage Service (S3) bucket as the origin and use Amazon CloudFront to distribute the content. There are two primary benefits of this solution. Foremost is the convenience of caching static content at edge locations. The second reason is that you can define web access control lists (web ACLs) for the CloudFront distribution, which helps you secure requests to the content with minimal configuration and administrative overhead.\nHowever, there is a common architectural limitation to the standard, recommended approach. In some environments, you want virtual firewall appliances deployed in a virtual private cloud (VPC) to inspect all content, including static content. The standard approach doesnâ€™t route traffic through the VPC for inspection. This pattern provides an alternative architectural solution. You still use a CloudFront distribution to serve static content in an S3 bucket, but the traffic is routed through the VPC by using an Application Load Balancer. An AWS Lambda function then retrieves and returns the content from the S3 bucket.\nContents What is Amazon CloudFront ? Amazon S3 WAF-ALB-Lambda In the following sections, we will delve into the fundamental concepts of VPC.\n"},{"uri":"/en/3-implement/3.1-preex/","title":"Prerequisites","tags":[],"description":"","content":"Prerequisites An AWS Account. Static website content hosted in an S3 bucket. S3 Bucket For desmotrative purpose, we can use two different image in S3 bucket.\nIn AWS Management Console \u0026gt; Search S3 \u0026gt; Chose S3 Interface. Assign name for S3 bucket ( unique globally), leave other fields at thier default value, even the \u0026ldquo;Block all public access field\u0026rdquo;. Scroll down to create S3 bucket. Check the result then upload two images in S3 bucket. Attachments\rImg3_A.png\r(69 KB)\rImg3_B.png\r(71 KB)\r5. Upload succesfully "},{"uri":"/en/","title":"Serve S3 bucket static content through VPC with Amazon CloudFront","tags":[],"description":"","content":"Serve S3 bucket static content through VPC with Amazon CloudFront Overview In this workshop we will dicuss how to serve static content in an Amazon S3 bucket through a VPC using Amazon CloudFront How to improve performance, security, and reliability of a architecture by using CloudFront. Content Introduction Architecture Implement Summary "},{"uri":"/en/4-summary/4.1-summary/","title":"Summary","tags":[],"description":"","content":"What we can improve ? Implement Amazon Route 53 and Geolocation Routing. To automate the deployment of static content using this approach, create CI/CD pipelines to update the Amazon S3 buckets that host websites. Make sure to properly define the cache for the CloudFront distribution. Implement WAF security rules. Upgrade ALB connection to HTTPS. Related Resources Optimizing caching and availability CloudFront documentation Lambda functions as targets Elastic Load Balancing documentation Lambda quotas Lambda documentation AWS service websites:\nApplication Load Balancer Lambda CloudFront Amazon S3 AWS WAF Amazon VPC "},{"uri":"/en/1-introduce/1.1-cloudfront/","title":"What is Amzon CloudFront?","tags":[],"description":"","content":"Amazon CloudFront Amazon CloudFront is a content delivery network (CDN) offered by Amazon Web Services (AWS). A CDN is a network of geographically distributed servers that cache content, such as website files, images, and videos, closer to users. This helps to improve the speed and reliability of content delivery by reducing the distance that data needs to travel.\nHere are some key benefits of using Amazon CloudFront:\nFaster content delivery: By caching content closer to users, CloudFront can significantly reduce the time it takes for users to load your website or application. This can improve user experience and engagement.\nReduced latency: Latency is the time it takes for data to travel between a user\u0026rsquo;s device and the server that hosts the content. By using CloudFront, you can reduce latency for users who are located far away from your origin server.\nImproved scalability: CloudFront can automatically scale to meet the demands of your traffic. This means that your website or application will be able to handle sudden spikes in traffic without any performance issues.\nIncreased security: CloudFront can help to protect your website or application from distributed denial-of-service (DDoS) attacks by distributing traffic across multiple edge locations.\nOverall, Amazon CloudFront is a powerful tool that can help you improve the performance, scalability, and security of your website or application.\n"},{"uri":"/en/2-architecture/","title":"Architecture","tags":[],"description":"","content":"Overview In this section, we will take an in-depth look at how the suggested architecture works.\nContents Architecture Flow Pros and cons "},{"uri":"/en/4-summary/4.2-cleanup/","title":"Clean up resources","tags":[],"description":"","content":"Clean up resources In CloudFront Management \u0026gt; Security, Disalbe AWS WAF protection. AWS Console \u0026gt; CloudFront \u0026gt; Delete the resources. AWS Console \u0026gt; EC2 \u0026gt; Load Balancer \u0026gt; Delete the WS1-ALB. Next, we delete the target group mapping to our Lambda function. AWS Console \u0026gt; Lambda \u0026gt; Delete WS1_Lambda. AWS Console \u0026gt; S3 Bucket \u0026gt; Empty and delete Bucket resource (ws1-s3 bucket). S3 Bucket deleted successfully. Finally, AWS Console \u0026gt; VPC \u0026gt; My VPC \u0026gt; delete WS1_VPC that we created. WS1_VPC has been successfully deleted. All the subnet and security group attach to it follows. "},{"uri":"/en/3-implement/3.2-vpcsubnet/","title":"Create VPC and Subnet","tags":[],"description":"","content":"We create a VPC and two public subnet in it. Those subnet is where our Application Load Balancer sit.\nCreate VPC Access the AWS Management Console interface: Locate and click on VPC Choose VPC Within the VPC interface: Select Your VPC Click on Create VPC Setting for the VPC: Choose Resource and select VPC only Enter Name tag as WS1-VPC Set IPv4 CIDR to 10.10.0.0/16 After the VPC is created, we edit the VPC setting to enable DNS hostname. Create subnet We will create a public subnet for the application load balancer to sits. To do this go to VPC interface: Attach our public sunbet to VPC Procced with IP CIDR block is 10.10.1.0/24. Other fields can leave at their default value. On the public subnet we will want it to assign the IP address for us: Next we create internet gateway so that every component in our VPC can route traffic through internet: After we created the internet gateway, it have \u0026ldquo;Detatched\u0026rdquo; state (1). Attach it to public subnet: Lastly, we make ***route table ***so that our component in public subnet can connect to internet. Back to VPC interface: We attach rotue table to our VPC and name it as WS1_PulicRouteTable: Edit route table: Click \u0026ldquo;Add route\u0026rdquo; and add route to route all traffic (0.0.0.0/0) to Internet Gateway that we created. Finally, attach route table to our Public Subnet. Internet Facing Load Balancer require at least two public facing subnet for high availbility. -\u0026gt; Create another public subnet follow the same procedure with CIDR 10.10.2.0/24\nCreate Security Group For our Application Load Balancer to work, we need to create a security group to allow traffic target it. (Inbound Rule) In the VPC Interface \u0026gt; Security Section in the left menu \u0026gt; Security Groups \u0026gt; Create security group Configure the security group as follow: Default security group only allow outbound traffic which not allow other on internet to communicate to our Applicaiton Load Balancer.\nWith that our VPC and subnet are ready for a public facing Load Balancer.\n"},{"uri":"/en/2-architecture/2.2-procon/","title":"Pros and Cons","tags":[],"description":"","content":"Benefits The traffic is routed through the VPC for inspection. -\u0026gt; Very flexible when handing logic between VPC resource and S3 static content. This mean more security.\nThe convenience of caching static content at edge locations.\nYou can define web access control lists (web ACLs) for the CloudFront distribution (using WAF), which helps you secure requests to the content with minimal configuration and administrative overhead.\nThis is an easy to expand architecture which can be apply to many use case.\nLimitations The resources in this pattern must be in a single AWS Region, but they can be provisioned in different AWS accounts.\nLimits apply to the maximum request and response size that the Lambda function can receive and send, respectively. For more information, see Limits in Lambda functions as targets (Elastic Load Balancing documentation).\nIt\u0026rsquo;s important to find a good balance between performance, scalability, security, and cost-effectiveness when using this approach. Despite the high scalability of Lambda, if the number of concurrent Lambda invocations exceeds the maximum quota, some requests are throttled.\nFor more information, see Lambda quotas.\nYou also need to consider pricing when using Lambda. To minimize Lambda invocations, make sure that you properly define the cache for the CloudFront distribution. See Optimizing caching and availability (CloudFront documentation).\n"},{"uri":"/en/1-introduce/1.2-amazons3/","title":"What is an S3 Bucket?","tags":[],"description":"","content":"Amazon S3 S3 stands for Amazon Simple Storage Service. It\u0026rsquo;s a scalable object storage service offered by Amazon Web Services (AWS). Think of it as a giant, secure, and flexible online storage locker. Here are its key features:\nScalable: Store any amount of data, from a few megabytes to petabytes, and easily scale up or down as your needs change. Object storage: Store any type of file, from images and videos to documents and code, without worrying about file formats or structures. Durable: S3 ensures your data is extremely unlikely to be lost, with 99.999999999% (11 nines) of data durability. Secure: Control who can access your data and what they can do with it, using various security features. Cost-effective: Choose from different storage tiers based on your data access needs, optimizing costs for frequently and infrequently accessed data. S3 Bucket An S3 bucket acts like a virtual container within the S3 service. It serves as a designated space to organize and store your individual data objects (files, images, etc.) to categorize and manage your data within S3.\n"},{"uri":"/en/3-implement/","title":"Implementation","tags":[],"description":"","content":"Implementation steps In this section, we will implement the architecture.\nContent Prepare Create VPC and Subnet Create Lambda function Create Application Load Balancer Create CloudFront Distribution Create WAF Testing "},{"uri":"/en/3-implement/3.3-createlamda/","title":"Lambda function","tags":[],"description":"","content":"Create Lambda Function Access the AWS Management Console interface: Locate and click on Lambda Choose Lambda If you currently don\u0026rsquo;t have any lambda function. Choose \u0026ldquo;Create a function\u0026rdquo;. Create a Lambda function with a name. Other fields can be left at their default values There is a different module import syntax between Node 16.x.x with later version. For this workshop we will stick with Node 16.x.x.\nUsing this code to handle the request from ALB to our Lambda function:\n/** * This is an AWS Lambda function created for demonstration purposes. * It retrieves static assets from a defined Amazon S3 bucket. * To make the content available through a URL, use an Application Load Balancer with a Lambda integration. * * Set the S3_BUCKET environment variable in the Lambda function definition. */ // Import the AWS SDK for interacting with AWS services var AWS = require(\u0026#39;aws-sdk\u0026#39;); // Define the Lambda function handler exports.handler = function(event, context, callback) { var bucket = process.env.S3_BUCKET; var key = event.path.replace(\u0026#39;/\u0026#39;, \u0026#39;\u0026#39;); if (key == \u0026#39;\u0026#39;) { key = \u0026#39;index.html\u0026#39;; } // Fetch from S3 var s3 = new AWS.S3(); return s3.getObject({Bucket: bucket, Key: key}, function(err, data) { // Handle errors if encountered if (err) { return err; } // Determine encoding based on content type (base64 for images, utf8 otherwise) var isBase64Encoded = false; var encoding = \u0026#39;utf8\u0026#39;; if (data.ContentType.indexOf(\u0026#39;image/\u0026#39;) \u0026gt; -1) { isBase64Encoded = true; encoding = \u0026#39;base64\u0026#39; } // Construct the response object with appropriate headers and body var resp = { statusCode: 200, headers: { \u0026#39;Content-Type\u0026#39;: data.ContentType, }, body: new Buffer(data.Body).toString(encoding), isBase64Encoded: isBase64Encoded }; // Invoke the callback to return the response callback(null, resp); } ); }; This code fetch from S3 bucket and return the static resource to ALB.\nThe specific request and response format specify in this Document. Refer to it for more infomation.\nAfter create Lambda function, we scroll down to Code tab then paste in the snippet. Save it with Ctrl+S (Windows) or File \u0026gt; Save. Then deploy it to our Lambda function. With the snippet deployed, we add the permission for interact with resources in S3 bucket. Choose Configuration tab then: Attach S3 full access policy: Add Lamba Function to target group Lambda functions can be added to a target group for later use with our Application Load Balancer.\nAccess the AWS Management Console interface: Locate and click on EC2 Choose EC2 Scroll down and click on the Target Group section \u0026gt; Create target groups. Choose Lambda function as our target group. Then Click Next: In the next section, add Lamba function to the target group. Successfully created Target Group: "},{"uri":"/en/1-introduce/1.3-waf-alb-lambda/","title":"WAF, Application Load Balancer &amp; Lambda","tags":[],"description":"","content":"AWS Web Application Firewall (WAF) Amazon WAF, stands for AWS Web Application Firewall, is a web application firewall that safeguards your applications from cyberattacks. It allowing you to configure custom rules that control web traffic based on various criteria, including IP addresses, HTTP headers, body content, URLs, and protection against specific vulnerabilities like SQL injection and cross-site scripting. Additionally, AWS WAF offers prebuilt rules, bot control, and monitoring capabilities to fortify your application\u0026rsquo;s security posture.\nApplication Load Balancer (ALB) An application load balancer (ALB) is a network device that acts as a traffic director for your applications. It sits in front of your web servers and distributes incoming traffic among them.\nAn AWS application load balancer offers several features:\nSmart routing: Directs traffic based on URL, headers, or other details.\nHTTPS redirection: Makes switching to secure connections automatic.\nTLS management: Handles encryption/decryption, improving server performance.\nServer Name Indication (SNI): Selects the appropriate SSL certificate based on the client\u0026rsquo;s hostname.\nSticky sessions: Keeps users connected to the same server by using cookies for a better experience.\nSecurity integration: Works with AWS WAF to protect your applications.\nAWS Lambda `AWS Lambda is a serverless compute service, meaning you don\u0026rsquo;t have to manage servers to run your code. You simply upload your code, and AWS Lambda takes care of everything else, including provisioning, scaling, and managing the underlying infrastructure.\nServerless architecture offers advantages like:\nCost-effectiveness: You only pay for the resources your code uses, eliminating idle server costs.\nScalability: Lambda can automatically scale your code to handle any amount of traffic.\nFaster development: Focus on writing code without worrying about server management.\nAWS Lambda Function is an individual piece of code that runs on AWS Lambda. You can write your function in various supported languages (like Python, Node.js, Java) and define its purpose, like processing data, responding to API requests, or triggering other AWS services.\nCharacteristics:\nSelf-contained: Each function is a complete unit with its own code and logic.\nEvent-driven: They are triggered by specific events, such as a file upload to S3 or an API Gateway request.\n"},{"uri":"/en/3-implement/3.4-createalb/","title":"Create Application Load Balancer","tags":[],"description":"","content":"Create Application Load Balancer (ALB) Go to AWS Console \u0026gt; EC2and choose the EC2 interface. Scoll down to Load Balancing Category then click on Load Balancers. Then choose Create Load Balancer. In this workshop we will choose ALB: The Application Load Balancer type is internet facing ALB. Next, name it WS1_ALB: Map ALB to WS1_VPC VPC, and two public subnet: Internet Facing Load Balancer has a publicly accessible address and forwards those requests to healthy servers behind the scenes.\nFor Internet facing load balancer to work we need an Public Subnet with Internet Access.\nTo make this simple we will choose HTTP Listener for ALB then associate that listener with Lambda target group that we create from step 3.4. Choose suitable security group for our ALB to receive traffic from internet. Review and create ALB. "},{"uri":"/en/4-summary/","title":"Summary and Cleanup","tags":[],"description":"","content":"Summary and Cleanup At the end of this workshop, we will summary and clean up the resources.\nContent Summary Clean up "},{"uri":"/en/3-implement/3.5-cloudfront/","title":"Create CloudFront Origin","tags":[],"description":"","content":"Create CloudFront Origin Create Amazon CloudFront distribution: In AWS Console \u0026gt; Search CloudFront \u0026gt; CloudFront Choose \u0026ldquo;Create a CloudFront distribution\u0026rdquo;. Add Application Load Balancer as CloudFront origin. Set cache policy as you wish: Enalbe WAF in CloudFront with core protection: Choose suitable price class and create cloudfront distribution. CloudFront distribution created successfully. Remember the origin as we need it to test if it working correctly. "},{"uri":"/en/3-implement/3.6-createwaf/","title":"Create Amazon WAF","tags":[],"description":"","content":"Configure Amazon Web Application Firewall In previous section, we created WAF with CloudFront, however, the WAF is still at core protection mode. We can leverage the power of Amazon WAF to protect our origin. When we Enalbe CloudFront WAF for core protection we actually create a WAF. To view it in detail we follow: This is detail overview of Amazon WAF attached to CloudFront. We can use rule tab to add more rule to our WAF. Add rule and tweak it based on industrial requirement: "},{"uri":"/en/3-implement/3.7-testing/","title":"Testing the Result","tags":[],"description":"","content":"What happen to other CloudFront origin as Application Load Balancer? In the original diagram, there is two Application Load Banlancer. of different region. To achive this, we do not configure in CloudFront distribution origin. Instead, we configure it in Amazon Route 53 to route our traffic to the right AZ origin by using \u0026ldquo;Geolocation Routing\u0026rdquo;. More information about it can be found here AWS Document\nFetch diffrent resources in CloudFront If we can fetch the static resources in S3 bucket that mean our set up is working correctly. (Using two images provided in S3 bucket).\nWe fetch Img3_A.png and Img3_B.png from CloudFront origin. "},{"uri":"/en/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"/en/tags/","title":"Tags","tags":[],"description":"","content":""}]